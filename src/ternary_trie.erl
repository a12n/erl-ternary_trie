%%%-------------------------------------------------------------------
%%% @author Anton Yabchinskiy <arn@bestmx.ru>
%%% @doc
%%% @end
%%% For copyright notice see LICENSE.
%%%-------------------------------------------------------------------
-module(ternary_trie).

%% Types
-export_type([key/0, ternary_trie/0, t/0, value/0]).

%% API
-export([from_list/1, new/0]).

%% API
-export([fetch/2, fetch_keys/1, find/2, is_key/2, longest_prefix/2,
         prefix_match/2, size/1, store/3, wildcard_match/2]).

%%%===================================================================
%%% Types
%%%===================================================================

-type key() :: binary() | string().

-type value() :: any().

-record(node, { key   :: byte() | char(),
                value :: value(),
                left  :: #node{},
                mid   :: #node{},
                right :: #node{} }).

-opaque ternary_trie() :: (_Empty :: undefined) | (_Root :: #node{}).

-type t() :: ternary_trie().

%%%===================================================================
%%% API
%%%===================================================================

%%--------------------------------------------------------------------
%% @doc
%% @end
%%--------------------------------------------------------------------
-spec from_list([{key(), value()}]) -> ternary_trie().

from_list(List) ->
    lists:foldl(fun({Key, Value}, TST) ->
                        store(Key, Value, TST)
                end, new(), List).

%%--------------------------------------------------------------------
%% @doc
%% @end
%%--------------------------------------------------------------------
-spec new() -> ternary_trie().

new() ->
    _Empty = undefined.

%%%===================================================================
%%% API
%%%===================================================================

%%--------------------------------------------------------------------
%% @doc
%% @end
%%--------------------------------------------------------------------
-spec fetch(key(), ternary_trie()) -> value().

fetch(Key, TST) ->
    case find(Key, TST) of
        {ok, Value} ->
            Value;
        _Other ->
            error(badarg)
    end.

%%--------------------------------------------------------------------
%% @doc
%% @end
%%--------------------------------------------------------------------
-spec fetch_keys(ternary_trie()) -> [key()].

fetch_keys(_TST) ->
    error(undef).

%%--------------------------------------------------------------------
%% @doc
%% @end
%%--------------------------------------------------------------------
-spec find(key(), ternary_trie()) -> {ok, value()} | false.

find(_Key, _TST) ->
    error(undef).

%%--------------------------------------------------------------------
%% @doc
%% @end
%%--------------------------------------------------------------------
-spec is_key(key(), ternary_trie()) -> boolean().

is_key(_Key, _TST) ->
    error(undef).

%%--------------------------------------------------------------------
%% @doc
%% @end
%%--------------------------------------------------------------------
-spec longest_prefix(key(), ternary_trie()) -> {ok, key()} | false.

longest_prefix(_Key, _TST) ->
    error(undef).

%%--------------------------------------------------------------------
%% @doc
%% @end
%%--------------------------------------------------------------------
-spec prefix_match(key(), ternary_trie()) -> [key()].

prefix_match(_Key, _TST) ->
    error(undef).

%%--------------------------------------------------------------------
%% @doc
%% @end
%%--------------------------------------------------------------------
-spec size(ternary_trie()) -> non_neg_integer().

size(_TST) ->
    error(undef).

%%--------------------------------------------------------------------
%% @doc
%% @end
%%--------------------------------------------------------------------
-spec store(key(), value(), ternary_trie()) -> ternary_trie().

store(_Key, _Value, _TST) ->
    error(undef).

%%--------------------------------------------------------------------
%% @doc
%% @end
%%--------------------------------------------------------------------
-spec wildcard_match(key(), ternary_trie()) -> [key()].

wildcard_match(_Key, _TST) ->
    error(undef).

%%%===================================================================
%%% Internal functions
%%%===================================================================
